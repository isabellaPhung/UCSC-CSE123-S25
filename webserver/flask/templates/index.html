<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
        }
        
        .left-section {
            width: 25%;
            border-right: 1px solid #ccc;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .middle-section {
            width: 50%;
            border-right: 1px solid #ccc;
            padding: 20px;
        }
        
        .right-section {
            width: 25%;
            padding: 20px;
        }
        
        .date-time {
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .habits {
            margin-bottom: 30px;
        }
        
        h2 {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .habit-list {
            min-height: 100px;
        }
        
        .deadlines-section {
            display: flex;
            flex-direction: column;
        }
        
        .header-with-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .controls {
            display: flex;
            gap: 5px;
        }
        
        .control-btn {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 1px solid #ccc;
            background: #f5f5f5;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        
        .control-btn:hover {
            background: #e0e0e0;
        }
        
        .deadlines-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .deadlines-header h1 {
            margin: 0;
            font-size: 1.8em;
        }
        
        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tasks-container {
            display: flex;
        }
        
        .tasks-list {
            flex: 1;
        }
        
        .assigned-times {
            flex: 1;
            text-align: right;
        }
        
        .task-row {
            padding: 8px 0;
            margin-bottom: 5px;
            cursor: pointer;
        }
        
        .time-row {
            padding: 8px 0;
            margin-bottom: 5px;
            text-align: right;
            color: #555;
        }
        
        .task-row:hover {
            background-color: #f0f0f0;
        }
        
        .habits-link {
            color: #0066cc;
            text-decoration: none;
            font-weight: bold;
        }
        
        .habits-link:hover {
            text-decoration: underline;
        }
        
        .editable-input {
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 5px;
            width: 90%;
            font-family: inherit;
            font-size: inherit;
        }
        
        .habit-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            margin-bottom: 5px;
        }
        
        .habit-checkbox {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .habit-text {
            flex-grow: 1;
            cursor: pointer;
        }
        
        .habit-text:hover {
            background-color: #f0f0f0;
        }
        
        .events-container {
            display: flex;
            margin-bottom: 10px;
        }
        
        .event-name {
            flex-grow: 1;
            cursor: pointer;
            padding: 5px 0;
        }
        
        .event-name:hover {
            background-color: #f0f0f0;
        }
        
        .event-time {
            width: 90px;
            text-align: right;
            cursor: pointer;
            padding: 5px 0;
        }
        
        .event-time:hover {
            background-color: #f0f0f0;
        }
        
        .event-headers {
            display: flex;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .event-header-name {
            flex-grow: 1;
        }
        
        .event-header-time {
            width: 90px;
            text-align: right;
        }
        
        .task-details {
            display: none;
            padding: 10px;
            margin-top: 5px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        
        .task-details-visible {
            display: block;
        }
        
        .task-description {
            margin-bottom: 10px;
        }
        
        .task-due-date {
            color: #666;
            font-size: 0.9em;
        }
        
        .task-timestamp {
            color: #888;
            font-size: 0.8em;
            margin-top: 5px;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .task-item:hover {
            background-color: #f5f5f5;
        }
        
        .task-name {
            font-weight: bold;
        }
        
        .no-tasks-message {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        
        .current-date-display {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2em;
            text-align: center;
        }
        
        .calendar-link {
            background-color: #2196F3;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- Left Section - 1/4 width -->
    <div class="left-section">
        <div class="date-time">
            <h2>Date & Time</h2>
            <div id="current-date-time"></div>
        </div>
        
        <div class="habits">
            <h2><a href="habits.html" class="habits-link">Habits</a></h2>
            <div class="habit-list" id="main-habits-list">
                <!-- Habits will be dynamically loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Middle Section - 2/4 width -->
    <div class="middle-section">
        <div class="deadlines-section">
            <div class="deadlines-header">
                <div class="section-title">
                    <h1>Today's Tasks</h1>
                    <div class="controls">
                        <a href="calendar.html" class="calendar-link">Calendar</a>
                        <button class="control-btn add-task" id="add-task-btn" title="Add Task">+</button>
                        <button class="control-btn remove-task" title="Remove Task">-</button>
                    </div>
                </div>
            </div>
            
            <div class="current-date-display" id="current-date-display"></div>
            
            <div id="today-tasks-container">
                <!-- Today's tasks will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Right Section - 1/4 width -->
    <div class="right-section">
        <div class="event-section">
            <div class="header-with-controls">
                <h2>Event</h2>
                <div class="controls">
                    <button class="control-btn add-event">+</button>
                    <button class="control-btn remove-event">-</button>
                </div>
            </div>
            <div class="event-headers">
                <div class="event-header-name">Event Name</div>
                <div class="event-header-time">Time</div>
            </div>
            <div id="events">
                <!-- Events will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const dateTimeElement = document.getElementById('current-date-time');
            dateTimeElement.textContent = now.toLocaleString();
            
            // Update today's date display
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date-display').textContent = now.toLocaleDateString(undefined, options);
        }
        
        // Update every second
        setInterval(updateDateTime, 1000);
        updateDateTime(); // Initial call
        
        // Default habits array (shared between pages)
        const defaultHabits = [
            { text: "Morning Exercise", completed: false },
            { text: "Read 30 minutes", completed: false },
            { text: "Drink 8 glasses of water", completed: true },
            { text: "Plan next day", completed: false }
        ];
        
        // Default events array
        const defaultEvents = [
            { name: "Team Meeting", time: "2:00 PM" },
            { name: "Project Deadline", time: "5:00 PM" },
            { name: "Doctor Appointment", time: "9:30 AM" }
        ];
        
        // Load saved habits or use defaults
        function loadHabits() {
            let habits = JSON.parse(localStorage.getItem('habits')) || defaultHabits;
            const habitsList = document.getElementById('main-habits-list');
            habitsList.innerHTML = '';
            
            habits.forEach(habit => {
                const habitItem = document.createElement('div');
                habitItem.className = 'habit-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'habit-checkbox';
                checkbox.checked = habit.completed;
                checkbox.addEventListener('change', function() {
                    habit.completed = this.checked;
                    saveHabits(habits);
                });
                
                const habitText = document.createElement('div');
                habitText.className = 'habit-text';
                habitText.textContent = habit.text;
                habitText.addEventListener('click', function() {
                    makeEditableHabit(this, habits);
                });
                
                habitItem.appendChild(checkbox);
                habitItem.appendChild(habitText);
                habitsList.appendChild(habitItem);
            });
        }
        
        // Load today's tasks from localStorage
        function loadTodaysTasks() {
            const tasks = JSON.parse(localStorage.getItem('tasksList')) || [];
            const tasksContainer = document.getElementById('today-tasks-container');
            tasksContainer.innerHTML = '';
            
            // Get today's date in YYYY-MM-DD format
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const todayStr = `${year}-${month}-${day}`;
            
            // Filter tasks for today
            const todaysTasks = tasks.filter(task => task.dueDate === todayStr);
            
            // Sort by time
            todaysTasks.sort((a, b) => {
                return a.timestamp - b.timestamp;
            });
            
            // Check if there are any tasks for today
            if (todaysTasks.length === 0) {
                const noTasksMsg = document.createElement('div');
                noTasksMsg.className = 'no-tasks-message';
                noTasksMsg.textContent = 'No tasks scheduled for today. Click the + button to add a task.';
                tasksContainer.appendChild(noTasksMsg);
                return;
            }
            
            // Display today's tasks
            todaysTasks.forEach((task, index) => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.dataset.index = index;
                
                const taskName = document.createElement('div');
                taskName.className = 'task-name';
                taskName.textContent = task.name;
                
                const taskTime = document.createElement('div');
                taskTime.className = 'task-time';
                taskTime.textContent = task.displayTime;
                
                taskItem.appendChild(taskName);
                taskItem.appendChild(taskTime);
                
                // Create task details section
                const taskDetails = document.createElement('div');
                taskDetails.className = 'task-details';
                
                // Add description
                const description = document.createElement('div');
                description.className = 'task-description';
                description.textContent = task.description || 'No description provided';
                taskDetails.appendChild(description);
                
                // Add due date/time
                const dueDate = document.createElement('div');
                dueDate.className = 'task-due-date';
                dueDate.textContent = `Due: ${new Date(task.timestamp * 1000).toLocaleString()}`;
                taskDetails.appendChild(dueDate);
                
                // Add timestamp
                const timestamp = document.createElement('div');
                timestamp.className = 'task-timestamp';
                timestamp.textContent = `Unix Timestamp: ${task.timestamp}`;
                taskDetails.appendChild(timestamp);
                
                // Toggle details visibility on click
                taskItem.addEventListener('click', function() {
                    taskDetails.classList.toggle('task-details-visible');
                });
                
                // Append to task container
                tasksContainer.appendChild(taskItem);
                tasksContainer.appendChild(taskDetails);
            });
        }
        
        // Load saved events or use defaults
        function loadEvents() {
            let events = JSON.parse(localStorage.getItem('events')) || defaultEvents;
            const eventsList = document.getElementById('events');
            eventsList.innerHTML = '';
            
            events.forEach(event => {
                const eventContainer = document.createElement('div');
                eventContainer.className = 'events-container';
                
                const eventName = document.createElement('div');
                eventName.className = 'event-name';
                eventName.textContent = event.name;
                eventName.addEventListener('click', function() {
                    makeEditableEvent(this, 'name', events);
                });
                
                const eventTime = document.createElement('div');
                eventTime.className = 'event-time';
                eventTime.textContent = event.time;
                eventTime.addEventListener('click', function() {
                    makeEditableEvent(this, 'time', events);
                });
                
                eventContainer.appendChild(eventName);
                eventContainer.appendChild(eventTime);
                eventsList.appendChild(eventContainer);
            });
        }
        
        // Save habits to localStorage
        function saveHabits(habits) {
            localStorage.setItem('habits', JSON.stringify(habits));
        }
        
        // Save events to localStorage
        function saveEvents(events) {
            localStorage.setItem('events', JSON.stringify(events));
        }
        
        // Make habit text editable
        function makeEditableHabit(element, habitsArray) {
            const currentText = element.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentText;
            input.className = 'editable-input';
            
            // Replace the element with the input
            element.textContent = '';
            element.appendChild(input);
            input.focus();
            
            // Save on enter or blur
            function saveEdit() {
                if (input.parentElement) {
                    const newText = input.value.trim() || currentText;
                    input.parentElement.textContent = newText;
                    
                    // Update the habits array
                    const habitItem = input.parentElement.parentElement;
                    const habitsList = habitItem.parentElement;
                    const index = Array.from(habitsList.children).indexOf(habitItem);
                    
                    if (index !== -1 && habitsArray[index]) {
                        habitsArray[index].text = newText;
                        saveHabits(habitsArray);
                    }
                    
                    input.parentElement.addEventListener('click', function() {
                        makeEditableHabit(this, habitsArray);
                    });
                }
            }
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    saveEdit();
                }
            });
            
            // Remove the click event during editing
            element.removeEventListener('click', function() {
                makeEditableHabit(element, habitsArray);
            });
        }
        
        // Make event field editable
        function makeEditableEvent(element, field, eventsArray) {
            const currentText = element.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentText;
            input.className = 'editable-input';
            
            if (field === 'time') {
                input.style.width = '80px';
            }
            
            // Replace the element with the input
            element.textContent = '';
            element.appendChild(input);
            input.focus();
            
            // Save on enter or blur
            function saveEdit() {
                if (input.parentElement) {
                    const newText = input.value.trim() || currentText;
                    input.parentElement.textContent = newText;
                    
                    // Update the events array
                    const eventContainer = input.parentElement.parentElement;
                    const eventsList = eventContainer.parentElement;
                    const index = Array.from(eventsList.children).indexOf(eventContainer);
                    
                    if (index !== -1 && eventsArray[index]) {
                        eventsArray[index][field] = newText;
                        saveEvents(eventsArray);
                    }
                    
                    input.parentElement.addEventListener('click', function() {
                        makeEditableEvent(this, field, eventsArray);
                    });
                }
            }
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    saveEdit();
                }
            });
            
            // Remove the click event during editing
            element.removeEventListener('click', function() {
                makeEditableEvent(element, field, eventsArray);
            });
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Load habits, tasks, and events
            loadHabits();
            loadTodaysTasks();
            loadEvents();
        });
        
        // Task management - Redirect to add task page
        document.getElementById('add-task-btn').addEventListener('click', function() {
            window.location.href = 'add-task.html';
        });
        
        // Remove task functionality
        document.querySelector('.remove-task').addEventListener('click', function() {
            const tasks = JSON.parse(localStorage.getItem('tasksList')) || [];
            
            // Get today's date in YYYY-MM-DD format for filtering
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const todayStr = `${year}-${month}-${day}`;
            
            // Find tasks from today
            const todaysTasks = tasks.filter(task => task.dueDate === todayStr);
            
            if (todaysTasks.length > 0) {
                // Find the index of the last task for today in the original array
                const lastTaskIndex = tasks.findIndex(task => 
                    task.timestamp === todaysTasks[todaysTasks.length - 1].timestamp &&
                    task.name === todaysTasks[todaysTasks.length - 1].name
                );
                
                if (lastTaskIndex !== -1) {
                    // Remove the task
                    tasks.splice(lastTaskIndex, 1);
                    localStorage.setItem('tasksList', JSON.stringify(tasks));
                    loadTodaysTasks(); // Refresh the display
                }
            }
        });
        
        // Event management
        document.querySelector('.add-event').addEventListener('click', function() {
            const events = JSON.parse(localStorage.getItem('events')) || defaultEvents;
            events.push({ name: `New Event ${events.length + 1}`, time: "12:00 PM" });
            saveEvents(events);
            loadEvents();
        });
        
        document.querySelector('.remove-event').addEventListener('click', function() {
            const events = JSON.parse(localStorage.getItem('events')) || defaultEvents;
            if (events.length > 0) {
                events.pop();
                saveEvents(events);
                loadEvents();
            }
        });
        
        // Helper function to check if two dates are the same day
        function isSameDay(timestamp1, timestamp2) {
            const date1 = new Date(timestamp1 * 1000);
            const date2 = new Date(timestamp2 * 1000);
            
            return date1.getFullYear() === date2.getFullYear() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getDate() === date2.getDate();
        }
        
        // Helper function to format date for display
        function formatDate(timestamp) {
            const date = new Date(timestamp * 1000);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString(undefined, options);
        }
    </script>
</body>
</html>